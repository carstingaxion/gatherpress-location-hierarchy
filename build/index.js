(()=>{"use strict";var e,r={693(e,r,t){const n=window.wp.blocks,a=window.wp.i18n,s=window.wp.blockEditor,l=window.wp.components,o=window.wp.element,i=window.wp.data,h=window.wp.apiFetch;var c=t.n(h);const u=window.ReactJSXRuntime;function d({startLevel:e,endLevel:r,maxLevel:t,onChange:n}){const[s,l]=(0,o.useState)(null),[i,h]=(0,o.useState)(null),c=[(0,a.__)("Continent","gatherpress-venue-hierarchy"),(0,a.__)("Country","gatherpress-venue-hierarchy"),(0,a.__)("State","gatherpress-venue-hierarchy"),(0,a.__)("City","gatherpress-venue-hierarchy"),(0,a.__)("Street","gatherpress-venue-hierarchy"),(0,a.__)("Number","gatherpress-venue-hierarchy")],d=e=>(e-1)/(t-1)*100,p=e=>r=>{r.preventDefault(),l(e)},v=a=>{if(!s)return;const l=(e=>{if(!i)return 1;const r=i.getBoundingClientRect(),n=(e-r.left)/r.width,a=Math.round(n*(t-1))+1;return Math.max(1,Math.min(t,a))})(a.clientX);"start"===s?l<=r&&n({startLevel:l,endLevel:r}):"end"===s&&l>=e&&n({startLevel:e,endLevel:l})},g=()=>{l(null)};(0,o.useEffect)(()=>{if(s)return document.addEventListener("mousemove",v),document.addEventListener("mouseup",g),()=>{document.removeEventListener("mousemove",v),document.removeEventListener("mouseup",g)}},[s,e,r]);const _=d(e),m=d(r);return(0,u.jsxs)("div",{className:"dual-range-control",children:[(0,u.jsx)("div",{className:"dual-range-control__labels",children:c.slice(0,t).map((e,r)=>(0,u.jsx)("span",{className:"dual-range-control__label",children:e},r))}),(0,u.jsx)("div",{className:"dual-range-control__track-container",children:(0,u.jsxs)("div",{ref:h,className:"dual-range-control__track",children:[(0,u.jsx)("div",{className:"dual-range-control__range",style:{left:`${_}%`,width:m-_+"%"}}),(0,u.jsx)("button",{type:"button",className:"dual-range-control__handle dual-range-control__handle--start "+("start"===s?"is-dragging":""),style:{left:`${_}%`},onMouseDown:p("start"),"aria-label":(0,a.__)("Start level","gatherpress-venue-hierarchy")}),(0,u.jsx)("button",{type:"button",className:"dual-range-control__handle dual-range-control__handle--end "+("end"===s?"is-dragging":""),style:{left:`${m}%`},onMouseDown:p("end"),"aria-label":(0,a.__)("End level","gatherpress-venue-hierarchy")})]})}),(0,u.jsxs)("div",{className:"dual-range-control__output",children:[(0,u.jsx)("span",{className:"dual-range-control__output-label",children:(0,a.__)("Showing:","gatherpress-venue-hierarchy")}),(0,u.jsxs)("strong",{children:[c[e-1]||"",e!==r&&(0,u.jsxs)(u.Fragment,{children:[" "+(0,a.__)("to","gatherpress-venue-hierarchy")+" ",c[r-1]||""]})]})]})]})}const p=JSON.parse('{"UU":"telex/block-gatherpress-venue-hierarchy"}');(0,n.registerBlockType)(p.UU,{edit:function({attributes:e,setAttributes:r,context:t}){const{startLevel:n,endLevel:h,enableLinks:p,showVenue:v}=e,[g,_]=(0,o.useState)(""),[m,y]=(0,o.useState)(""),[f,w]=(0,o.useState)(7),[b,x]=(0,o.useState)(!0),[j,k]=(0,o.useState)(null),L=(0,i.useSelect)(e=>e("core/editor").getCurrentPostId(),[]),S=(0,i.useSelect)(e=>e("core/editor").getCurrentPostType(),[]),C=L||t.postId,N=S||t.postType;return N&&"gatherpress_event"!==N?(0,u.jsx)("p",{...(0,s.useBlockProps)(),children:(0,a.__)("This block must be used within a GatherPress event","gatherpress-venue-hierarchy")}):((0,o.useEffect)(()=>{if(!C)return _((0,a.__)("No post ID available","gatherpress-venue-hierarchy")),void x(!1);(async()=>{try{x(!0),k(null);const e=await c()({path:`/wp/v2/gatherpress-location?post=${C}&per_page=100`});let r="";try{const e=await c()({path:`/wp/v2/gatherpress_event/${C}`});e&&e.venue&&(r=e.venue.name||"")}catch(e){console.log("Could not fetch venue information:",e)}if(y(r),!e||0===e.length)return _(v&&r?r:(0,a.__)("No location hierarchy available for this event","gatherpress-venue-hierarchy")),void x(!1);const t=(e,r)=>{const t=[];let n=e;for(;n&&(t.unshift(n.name),n.parent&&0!==n.parent);)n=r.find(e=>e.id===n.parent);return t},s=(e.map(e=>e.id),e.map(e=>e.parent)),l=e.filter(e=>!s.includes(e.id)).map(r=>t(r,e)),o=Math.max(...l.map(e=>e.length));w(Math.min(o,7));const i=l.map(e=>{const r=Math.max(1,n),t=Math.min(h,e.length);return r>e.length?"":e.slice(r-1,t).join(" > ")}).filter(e=>""!==e);if(i.length>0){let e=i.join(", ");v&&r&&(e+=" > "+r),_(e)}else _(v&&r?r:(0,a.__)("No location hierarchy available at selected levels","gatherpress-venue-hierarchy"));x(!1)}catch(e){console.error("Error fetching location data:",e),k(e.message||"Unknown error"),_(v&&m?m:(0,a.__)("Error loading location hierarchy","gatherpress-venue-hierarchy")),x(!1)}})()},[C,n,h,v]),j?(0,u.jsxs)("p",{...(0,s.useBlockProps)(),children:[(0,a.__)("Error: ","gatherpress-venue-hierarchy")," ",j]}):(0,u.jsxs)(u.Fragment,{children:[(0,u.jsxs)(s.InspectorControls,{children:[(0,u.jsx)(l.PanelBody,{title:(0,a.__)("Hierarchy Levels","gatherpress-venue-hierarchy"),initialOpen:!0,children:(0,u.jsx)(d,{startLevel:n,endLevel:Math.min(h,f),maxLevel:f,onChange:({startLevel:e,endLevel:t})=>{r({startLevel:e,endLevel:t})}})}),(0,u.jsxs)(l.PanelBody,{title:(0,a.__)("Display Options","gatherpress-venue-hierarchy"),initialOpen:!0,children:[(0,u.jsx)(l.ToggleControl,{label:(0,a.__)("Show venue","gatherpress-venue-hierarchy"),help:(0,a.__)("Display the venue name at the end of the location hierarchy","gatherpress-venue-hierarchy"),checked:v,onChange:e=>r({showVenue:e})}),(0,u.jsx)(l.ToggleControl,{label:(0,a.__)("Enable term links","gatherpress-venue-hierarchy"),help:(0,a.__)("Link each location term to its archive page","gatherpress-venue-hierarchy"),checked:p,onChange:e=>r({enableLinks:e})})]})]}),(0,u.jsx)("p",{...(0,s.useBlockProps)(),children:b?(0,u.jsx)(l.Spinner,{}):g})]}))}})}},t={};function n(e){var a=t[e];if(void 0!==a)return a.exports;var s=t[e]={exports:{}};return r[e](s,s.exports,n),s.exports}n.m=r,e=[],n.O=(r,t,a,s)=>{if(!t){var l=1/0;for(c=0;c<e.length;c++){for(var[t,a,s]=e[c],o=!0,i=0;i<t.length;i++)(!1&s||l>=s)&&Object.keys(n.O).every(e=>n.O[e](t[i]))?t.splice(i--,1):(o=!1,s<l&&(l=s));if(o){e.splice(c--,1);var h=a();void 0!==h&&(r=h)}}return r}s=s||0;for(var c=e.length;c>0&&e[c-1][2]>s;c--)e[c]=e[c-1];e[c]=[t,a,s]},n.n=e=>{var r=e&&e.__esModule?()=>e.default:()=>e;return n.d(r,{a:r}),r},n.d=(e,r)=>{for(var t in r)n.o(r,t)&&!n.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:r[t]})},n.o=(e,r)=>Object.prototype.hasOwnProperty.call(e,r),(()=>{var e={57:0,350:0};n.O.j=r=>0===e[r];var r=(r,t)=>{var a,s,[l,o,i]=t,h=0;if(l.some(r=>0!==e[r])){for(a in o)n.o(o,a)&&(n.m[a]=o[a]);if(i)var c=i(n)}for(r&&r(t);h<l.length;h++)s=l[h],n.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return n.O(c)},t=globalThis.webpackChunkblock_gatherpress_venue_hierarchy=globalThis.webpackChunkblock_gatherpress_venue_hierarchy||[];t.forEach(r.bind(null,0)),t.push=r.bind(null,t.push.bind(t))})();var a=n.O(void 0,[350],()=>n(693));a=n.O(a)})();